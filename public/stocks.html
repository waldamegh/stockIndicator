<!DOCTYPE html>

<head>
    <meta charset="utf-8" />
    <title>Stock</title>
    <meta content="Stock" property="og:title" />
    <meta content="Stock" property="twitter:title" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Webflow" name="generator" />
    <link href="./stylesheets/stock.css" rel="stylesheet" type="text/css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script
        type="text/javascript">!function (o, c) { var n = c.documentElement, t = " w-mod-"; n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch") }(window, document);</script>
    <link href="./images/SI.svg" rel="shortcut icon" type="image/x-icon" />
    <link href="./images/SI.svg" rel="apple-touch-icon" />
    
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://cdn.canvasjs.com/jquery.canvasjs.min.js"></script>
    <script>
        window.onload = function () {
            let stockPrice = [];
            let sma = [];

            fetch('http://localhost:3000/sma', {
                method: 'POST',
                mode: "cors", // no-cors, *cors, same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                credentials: "same-origin", // include, *same-origin, omit
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: JSON.stringify({
                    symbol: "IBM",
                    numDays: "3"
                })
            }).then(function (response) {
                return response.json()
            }).then(function (data) {
                console.log(data)
                //chartData = document.getElementById("chartData")
                //chartData.innerHTML = JSON.stringify(data)
                sma = data.sma;
                stockPrice = data.stockPrice;
                let dataPoints = [];
                let dataPoints2 = [];
                for (let i = 0; i < sma.length; i++) {
                    dataPoints.push({ x: new Date(sma[i].date), y: sma[i].value })
                }
                for (let i = 0; i < stockPrice.length; i++) {
                    dataPoints2.push({ x: new Date(stockPrice[i].date), y: stockPrice[i].price })
                }
                var options = {
                    animationEnabled: true,
                    theme: "light2",
                    title: {
                        text: "SMA"
                    },
                    axisX: {
                        valueFormatString: "DD MMM"
                    },
                    axisY: {
                        prefix: "$",
                        minimum: 100
                    },
                    toolTip: {
                        shared: true
                    },
                    legend: {
                        cursor: "pointer",
                        verticalAlign: "bottom",
                        horizontalAlign: "left",
                        dockInsidePlotArea: true,
                        itemclick: toogleDataSeries
                    },
                    data: [{
                        type: "line",
                        showInLegend: true,
                        name: "Actual Price",
                        markerType: "square",
                        xValueFormatString: "DD MMM, YYYY",
                        color: "#F08080",
                        yValueFormatString: "#,##0K",
                        dataPoints: dataPoints2
                    },
                    {
                        type: "line",
                        showInLegend: true,
                        name: "SMA Value",
                        lineDashType: "dash",
                        yValueFormatString: "#,##0K",
                        dataPoints: dataPoints
                    }]
                };
                $("#chartContainer").CanvasJSChart(options);
            }).catch(error => console.error('Error:', error));

            function toogleDataSeries(e) {
                if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                } else {
                    e.dataSeries.visible = true;
                }
                e.chart.render();
            }

        }
    </script>
</head>

<body>
    <div>
        <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease"
            role="banner" class="navbar-logo-left-container shadow-three w-nav">
            <div class="container">
                <div class="navbar-wrapper"><a href="/" class="navbar-brand w-nav-brand"><img
                            src="./images/STOCKINDICTOR_LOGO.svg" loading="lazy" width="250" height="Auto" alt="" /></a>
                    <nav role="navigation" class="nav-menu-wrapper w-nav-menu">
                        <ul role="list" class="nav-menu-two w-list-unstyled">
                            <li><a href="#" class="nav-link">Stocks</a></li>
                            <li><a href="#" class="nav-link">Indicators</a></li>
                            <li>
                                <div data-hover="false" data-delay="0" class="nav-dropdown w-dropdown">
                                    <div class="nav-dropdown-toggle w-dropdown-toggle">
                                        <div>Pricing</div>
                                    </div>
                                    <nav class="nav-dropdown-list shadow-three mobile-shadow-hide w-dropdown-list"><a
                                            href="#" class="nav-dropdown-link w-dropdown-link">Resource Link 1</a><a
                                            href="#" class="nav-dropdown-link w-dropdown-link">Resource Link 2</a><a
                                            href="#" class="nav-dropdown-link w-dropdown-link">Resource Link 3</a></nav>
                                </div>
                            </li>
                            <li>
                                <div class="nav-divider"></div>
                            </li>
                            <li><a href="#" class="nav-link-accent">Docs</a></li>
                            <li class="mobile-margin-top-10"><a href="#" class="button-primary w-button">Login</a></li>
                        </ul>
                    </nav>
                    <div class="menu-button w-nav-button">
                        <div class="w-icon-nav-menu"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="w-layout-blockcontainer w-container">
        <div class="w-row">
            <div class="column w-col w-col-8">
                <div class="columns-5 w-row">
                    <div class="w-col w-col-1"><img src="./images/placeholder_small.svg" loading="lazy" width="40"
                            height="40" alt="" class="image" /></div>
                    <div class="w-col w-col-11">
                        <h2 class="heading-2">[stock symbol]</h2>
                    </div>
                </div>
                <div>
                    <div>
                        <div class="columns-4 w-row">
                            <div class="w-col w-col-4">
                                <div>[Price]</div>
                            </div>
                            <div class="w-col w-col-4">
                                <div>[indicator]</div>
                            </div>
                            <div class="w-col w-col-4">
                                <div>[numDays]</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="text-block-2">
                            <div id="chartData"></div>
                            <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-col w-col-4">
                <h3 class="heading">Overview</h3>
                <div class="columns w-row">
                    <div class="w-col w-col-4">
                        <div class="text-block">Stock name:</div>
                    </div>
                    <div class="w-col w-col-8">
                        <div>[name]</div>
                    </div>
                </div>
                <div class="columns-2 w-row">
                    <div class="w-col w-col-4">
                        <div class="text-block">Market:</div>
                    </div>
                    <div class="w-col w-col-8">
                        <div>[market]</div>
                    </div>
                </div>
                <div class="columns-3 w-row">
                    <div class="w-col w-col-4">
                        <div class="text-block">Industry:</div>
                    </div>
                    <div class="w-col w-col-8">
                        <div>[industry]</div>
                    </div>
                </div>
                <div class="columns-3 w-row">
                    <div class="w-col w-col-4">
                        <div class="text-block">Description:</div>
                    </div>
                    <div class="w-col w-col-8">
                        <div>[text]</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>

</html>